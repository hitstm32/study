因为要实现虚拟内存，所以要换入换出。虚拟内存给每个进程提供了4G平坦大内存的假象，然而实际情况中，总物理内存甚至只有1G，通过换入换出，只有用的时候再把某段内存映射到物理内存上。
![[Pasted image 20240327092621.png]]
具体实现：
![[Pasted image 20240327093021.png]]
如果要请求某个地址，会先去页表上查，MMU如果查到这个页表项没有映射（缺页），那就会触发**缺页中断（14号）**，进入页错误处理程序，从触发从磁盘进行换入，换入成功后，返回原处重新执行请求地址的指令，而不是让PC+1。由于程序运行局部性原理，换入换出可以很大程度提高内存利用效率。从而实现了单个进程独享4G大内存的假象。
![[Pasted image 20240327094119.png]]
系统初始化时，设置14号中断的中断处理程序：
![[Pasted image 20240327094337.png]]
压栈保存现场，进入内核栈，调用函数`_do_no_page`
![[Pasted image 20240327094415.png]]
申请一段空闲页，然后把磁盘中相应页读出，放入申请的页中。
![[Pasted image 20240327101657.png]]

**进程=虚拟内存管理+内核级线程**。内核级线程切换的核心就是栈的切换。对于用户来说，内核级线程切换其实就是两个内核级线程用户栈的切换，其实用户栈的切换是依赖于内核栈切换的。
![[Pasted image 20240407084958.png]]
# 从用户进入内核-系统调用（中断）


![[Pasted image 20240407090330.png]]
![[Pasted image 20240407090834.png]]
切换发生在遇到IO时，例如调用了sys_call，可能会发生磁盘操作，引发休眠。通过比较0和PCB->state，如果非0，则说明进程阻塞，那就需要调用reschedule。schedule就要完成切换五段中的三段，
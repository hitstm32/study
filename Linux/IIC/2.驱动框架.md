**bus是如何组织的，i2cbus和系统总bus之间的关系，为什么i2c设备树最外层没直接注册成一个一个driver**
![[Pasted image 20240828104700.png]]
IIC内核驱动分为5层。其中adapter driver（硬件IIC）和i2c-gpio（GPIO模拟IIC）为协议级别的实现。定义了最基础的IIC收发方法。I2C device driver层则定义了芯片级的驱动（芯片厂商编写，比如AT24C02的驱动）。这一层中比较特殊的存在是i2c-dev，这个驱动可以实现在用户空间中直接进行i2c传输，不通过专用的驱动程序，相当于**<span style="color:#ffc000">一根线，把用户收发内容直接传给Controller driver层</span>**。


# i2c系统驱动程序模型：
驱动程序位于i2c Device Driver层，i2c也被抽象成了总线设备模型。

# i2c-dev.c分析
i2c-dev是一个内核模块，该模块会根据芯片i2c adapter的数量注册i2c-dev驱动，并在VFS的`/dev/`下生成多个`/dev/i2c`，应用程序可以直接通过这些设备节点，来向i2c总线发送原始数据，在用户空间完成i2c驱动，免去了在驱动层写代码的麻烦.